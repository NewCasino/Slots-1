!function(a,b){b["true"]=a,function(a){a.config=a.config||{},_.extend(a.config,{targetFPS:60,width:500,height:400,background:"/images/bg.png",buttons:{src:"/images/buttons_sheet.png",spin:{sheet:{width:100,height:50,x:0,y:0,frames:5},position:{x:215,y:325}},arrows:{sheets:{up:{width:15,height:25,x:0,y:75,frames:5},down:{width:15,height:25,x:0,y:50,frames:5}},positions:{decreaseLines:{x:10,y:338},increaseLines:{x:50,y:338},decreaseBet:{x:75,y:338},increaseBet:{x:115,y:338}}}},fields:{lines:{font:"12px Helvetica",color:"#000000",x:37,y:350},bet:{font:"12px Helvetica",color:"#000000",x:102,y:350},totalBet:{font:"12px Helvetica",color:"#000000",x:172,y:350},win:{font:"12px Helvetica",color:"#000000",x:360,y:350},balance:{font:"12px Helvetica",color:"#000000",x:448,y:350}},symbols:{src:"/images/symbols_sheet.png",width:100,height:100},reel:{width:100,height:300,regX:0,regY:0,spinDuration:.4,spinDelay:.5,speed:2e3},payouts:[{symbol:0,probability:5,wins:[30,125,400]},{symbol:1,probability:5,wins:[20,100,300]},{symbol:2,probability:5,wins:[15,75,200]},{symbol:3,probability:5,wins:[10,50,150]},{symbol:4,probability:5,wins:[5,20,100]},{symbol:5,probability:5,wins:[5,20,100]},{symbol:6,probability:5,wins:[5,20,100]},{symbol:7,probability:5,wins:[5,20,100]},{symbol:8,probability:1,wins:[40,200,750]},{symbol:9,probability:1,wins:[50,300,1e3]}],lines:[[1,1,1,1,1],[2,2,2,2,2],[0,0,0,0,0],[2,1,0,1,2],[0,1,2,1,0],[0,0,1,0,0],[2,2,1,2,2],[1,2,2,2,1],[1,0,0,0,1],[0,1,1,1,0],[2,1,1,1,2],[0,1,0,1,0],[2,1,2,1,2],[1,0,1,0,1],[1,2,1,2,1],[1,1,0,1,1],[1,1,2,1,1],[0,2,0,2,0],[2,0,2,0,2],[1,0,2,0,1],[1,2,0,2,1],[0,0,2,0,0],[2,2,0,2,2],[0,2,2,2,0],[2,0,0,0,2],[0,2,1,2,0],[2,0,1,0,2],[0,0,1,2,2],[2,2,1,0,0],[1,0,1,2,1]]})}(window.Slots||{});var c={}.hasOwnProperty,d=function(a,b){function d(){this.constructor=a}for(var e in b)c.call(b,e)&&(a[e]=b[e]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},e=function(a,b){return function(){return a.apply(b,arguments)}};!function(a){"use strict";var b;return a.load=function(){var b,c;if(a.config)return b=$("canvas"),b.attr({width:a.config.width,height:a.config.height}),b.on("mousedown",function(){return!1}),this.stage=new createjs.Stage(b[0]),c=[{id:"bg",src:a.config.background},{id:"symbols",src:a.config.symbols.src},{id:"buttons",src:a.config.buttons.src}],this.loader=new createjs.LoadQueue(!1),this.loader.on("complete",this.init),this.loader.loadManifest(c)},a.init=function(){return a.user=new a.User(a.config.user),a.user.fetch().done(function(){return a.symbolBuilder=new a.SymbolBuilder,a.lineBuilder=new a.LineBuilder,a.state=new a.State,createjs.Ticker.timingMod=createjs.Ticker.RAF_SYNCHED,createjs.Ticker.setFPS(a.config.targetFPS),createjs.Ticker.on("tick",a.state.tick)})},a.User=function(a){function c(){return b=c.__super__.constructor.apply(this,arguments)}return d(c,a),c.prototype.urlRoot="/api/users",c.prototype.spin=function(a){var b,c=this;return b=$.Deferred(),$.post(""+this.url()+"/spin",a).success(function(a){return c.set("credits",a.credits),b.resolve(a)}),b.promise()},c}(Backbone.Model),a.State=function(){function b(b){var c=this;null==b&&(b={}),this.tick=e(this.tick,this),this.handleSpinResults=e(this.handleSpinResults,this),this.spin=e(this.spin,this),this.lines=[],this.totalLines=b.totalLines||a.config.lines.length,this.linesBet=this.totalLines,this.bet=1,this.initBG(),this.initReels(),this.initSpinButton(),this.initFieldButtons(),this.initFieldValues(),this.initReqCredits(),$(document.body).on("keypress",function(a){return 32===a.charCode?c.spin():void 0})}return b.prototype.initBG=function(){var b;return b=new createjs.Shape,b.graphics.beginBitmapFill(a.loader.getResult("bg")).drawRect(0,0,a.config.width,a.config.height),a.stage.addChild(b)},b.prototype.initReels=function(){var b,c;for(this.reels=[],b=c=0;4>=c;b=++c)this.reels[b]=new a.Reel({position:b})},b.prototype.initSpinButton=function(){var b,c,d,e,f,g;return b=a.config.buttons.spin,c=a.loader.getResult("buttons"),d=new createjs.SpriteSheet({images:[c],frames:{width:b.sheet.width,height:b.sheet.height,count:b.sheet.frames},animations:{"static":0,flash:{frames:function(){g=[];for(var a=0,c=b.sheet.frames-1;c>=0?c>=a:a>=c;c>=0?a++:a--)g.push(a);return g}.apply(this).concat(function(){f=[];for(var a=e=b.sheet.frames-2;1>=e?1>=a:a>=1;1>=e?a++:a--)f.push(a);return f}.apply(this))}}}),this.spinButton=new createjs.Sprite(d,"static"),this.spinButton.framerate=30,this.spinButton.width=b.sheet.width,this.spinButton.height=b.sheet.height,this.spinButton.x=b.position.x,this.spinButton.y=b.position.y,this.spinButton.on("click",this.spin),a.stage.addChild(this.spinButton)},b.prototype.initFieldButtons=function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,o=this;for(b=a.config.buttons.arrows,g=a.loader.getResult("buttons"),d=[],f=k=0,m=b.sheets.down.frames;m>=0?m>k:k>m;f=m>=0?++k:--k)d.push([b.sheets.down.x+f*b.sheets.down.width,b.sheets.down.y,b.sheets.down.width,b.sheets.down.height,0]);for(i=[],f=l=0,n=b.sheets.up.frames;n>=0?n>l:l>n;f=n>=0?++l:--l)i.push([b.sheets.up.x+f*b.sheets.up.width,b.sheets.up.y,b.sheets.up.width,b.sheets.up.height,0]);return c=new createjs.SpriteSheet({images:[g],frames:d,animations:{"default":0,clicked:[1,b.sheets.down.frames-1,"default",.5]}}),h=new createjs.SpriteSheet({images:[g],frames:i,animations:{"default":0,clicked:[1,b.sheets.up.frames-1,"default",.5]}}),e=new createjs.Sprite(c,"default"),e.width=b.sheets.down.width,e.height=b.sheets.down.height,j=new createjs.Sprite(h,"default"),j.width=b.sheets.up.width,j.height=b.sheets.up.height,this.decreaseLinesButton=e.clone(),_.extend(this.decreaseLinesButton,{x:b.positions.decreaseLines.x,y:b.positions.decreaseLines.y}),this.decreaseLinesButton.addEventListener("click",function(a){return a.target.gotoAndPlay("clicked"),o.decrementLines()}),this.decreaseBetButton=e.clone(),_.extend(this.decreaseBetButton,{x:b.positions.decreaseBet.x,y:b.positions.decreaseBet.y}),this.decreaseBetButton.addEventListener("click",function(a){return a.target.gotoAndPlay("clicked"),o.decrementBet()}),this.increaseLinesButton=j.clone(),_.extend(this.increaseLinesButton,{x:b.positions.increaseLines.x,y:b.positions.increaseLines.y}),this.increaseLinesButton.addEventListener("click",function(a){return a.target.gotoAndPlay("clicked"),o.incrementLines()}),this.increaseBetButton=j.clone(),_.extend(this.increaseBetButton,{x:b.positions.increaseBet.x,y:b.positions.increaseBet.y}),this.increaseBetButton.addEventListener("click",function(a){return a.target.gotoAndPlay("clicked"),o.incrementBet()}),a.stage.addChild(this.decreaseLinesButton),a.stage.addChild(this.decreaseBetButton),a.stage.addChild(this.increaseLinesButton),a.stage.addChild(this.increaseBetButton)},b.prototype.initFieldValues=function(){var b,c;return c=a.config.fields,b={textAlign:"center",textBaseline:"middle"},this.linesField=new createjs.Text(this.linesBet,c.lines.font,c.lines.color),_.extend(this.linesField,b,{x:c.lines.x,y:c.lines.y}),this.betField=new createjs.Text(this.bet,c.bet.font,c.bet.color),_.extend(this.betField,b,{x:c.bet.x,y:c.bet.y}),this.totalBetField=new createjs.Text(this.linesBet*this.bet,c.lines.font,c.totalBet.color),_.extend(this.totalBetField,b,{x:c.totalBet.x,y:c.totalBet.y}),this.winField=new createjs.Text(0,c.win.font,c.win.color),_.extend(this.winField,b,{x:c.win.x,y:c.win.y}),this.balanceField=new createjs.Text(a.user.get("credits"),c.balance.font,c.balance.color),_.extend(this.balanceField,b,{x:c.balance.x,y:c.balance.y}),a.stage.addChild(this.linesField),a.stage.addChild(this.betField),a.stage.addChild(this.totalBetField),a.stage.addChild(this.winField),a.stage.addChild(this.balanceField)},b.prototype.initReqCredits=function(){var a=this;return $("#request-credits").on("click",function(b){return b.preventDefault(),a.updateCredits(100,!0)})},b.prototype.incrementLines=function(){return this.spinningReelCount>0?void 0:(this.linesBet<this.totalLines&&this.linesBet++,this.linesField.text=this.linesBet,this.totalBetField.text=this.linesBet*this.bet,a.stage.update())},b.prototype.decrementLines=function(){return this.spinningReelCount>0?void 0:(this.linesBet>1&&this.linesBet--,this.linesField.text=this.linesBet,this.totalBetField.text=this.linesBet*this.bet,a.stage.update())},b.prototype.incrementBet=function(){return this.spinningReelCount>0?void 0:(this.bet++,this.betField.text=this.bet,this.totalBetField.text=this.linesBet*this.bet,a.stage.update())},b.prototype.decrementBet=function(){return this.spinningReelCount>0?void 0:(this.bet>1&&this.bet--,this.betField.text=this.bet,this.totalBetField.text=this.linesBet*this.bet,a.stage.update())},b.prototype.updateWin=function(b){return this.winField.text=b,a.stage.update()},b.prototype.updateCredits=function(b,c){var d;return null==b&&(b=0),d=a.user.get("credits")+b,c&&a.user.set("credits",d).save(),this.balanceField.text=d,a.stage.update()},b.prototype.spin=function(){var b,c,d,e,f,g,h,i;if(!(this.spinningReelCount>0)){for(;a.user.get("credits")<this.linesBet*this.bet;)if(this.bet>1)this.decrementBet();else{if(!(this.linesBet>1))return this.openInsufficientCreditsDialog();this.decrementLines()}for(h=this.lines,d=0,f=h.length;f>d;d++)b=h[d],a.stage.removeChild(b);for(this.spinningReelCount=5,i=this.reels,e=0,g=i.length;g>e;e++)c=i[e],c.startSpin();return this.spinButton.gotoAndPlay("flash"),this.updateWin(0),this.updateCredits(-this.linesBet*this.bet),a.user.spin({lines:this.linesBet,bet:this.bet}).done(this.handleSpinResults)}},b.prototype.openInsufficientCreditsDialog=function(){return alert("You're done.")},b.prototype.handleSpinResults=function(a){var b,c,d,e,f,g=this;for(f=this.reels,b=d=0,e=f.length;e>d;b=++d)c=f[b],c.completeSpin({values:a.values[b]}).done(function(){return g.completeSpin(a)})},b.prototype.completeSpin=function(b){var c,d,e,f,g,h,i,j,k,l,m,n;if(this.spinningReelCount--,0===this.spinningReelCount){if(this.spinButton.gotoAndPlay("static"),b.wins.length>0){for(this.lines=[],c={},m=b.wins,i=0,k=m.length;k>i;i++){for(h=m[i],n=h.matches,j=0,l=n.length;l>j;j++)e=n[j],c[e.position[0]]||(c[e.position[0]]={}),c[e.position[0]][e.position[1]]=1;d=a.lineBuilder.newLine(h.line),this.lines.push(d),a.stage.addChild(d)}for(f in c)g=c[f],this.reels[f].flash(g)}return this.updateWin(b.reward),this.updateCredits()}},b.prototype.tick=function(b){var c;c=b.delta/1e3,this.reels.forEach(function(a){return a.update(c)}),a.stage.update(b)},b}(),a.Reel=function(){function b(b){var c,d,e,f,g;for(c={},_.extend(c,a.config.reel,b),this.spinDuration=c.spinDuration,this.spinDelay=c.spinDelay,this.position=c.position,this.speed=c.speed,this.container=new createjs.Container,this.container.y=c.regY,this.container.x=c.position*c.width+c.regX,this.container.width=c.width,this.container.height=c.height,this.container.name="reel"+this.position,e=new createjs.Shape,e.x=this.container.x,e.y=this.container.y,e.graphics.drawRect(0,0,this.container.width,this.container.height),this.container.mask=e,d=g=0;3>=g;d=++g)f=a.symbolBuilder.newSprite(),f.y=f.height*d,this.container.addChild(f);this.render()}return b.prototype.isSpinning=!1,b.prototype.render=function(){return a.stage.addChild(this.container)},b.prototype.flash=function(a){var b;for(b in a)this.container.getChildAt(b).gotoAndPlay("flash")},b.prototype.startSpin=function(){return this.values=null,this.isSpinning=!0,this.isFinalPass=!1,this.timeSpinning=0,this.defer=$.Deferred()},b.prototype.completeSpin=function(a){return this.values=a.values.concat(Math.floor(Math.random()*this.numSymbols)),this.timeSpinning>this.spinDuration&&(this.timeSpinning=this.spinDuration),this.timeSpinning-=this.spinDelay*this.position,this.defer.promise()},b.prototype.update=function(b){var c,d,e,f,g,h,i,j,k;if(this.isSpinning)for(this.timeSpinning+=b,this.isFinalPass=this.timeSpinning>=this.spinDuration&&this.values,c=this.speed*b,h=this.container.children[0].y-c,this.isFinalPass&&0===this.values.length?0>h&&(h=0,this.isSpinning=!1,this.defer.resolve()):(g=-this.container.children[0].height,g>=h&&(h+=this.container.children[0].height,this.container.removeChildAt(0),e=_.last(this.container.children),f=this.isFinalPass?a.symbolBuilder.newSprite(this.values.shift()):a.symbolBuilder.newSprite(),f.y=e.y+e.height,this.container.addChild(f))),k=this.container.children,d=i=0,j=k.length;j>i;d=++i)f=k[d],f.y=h+d*f.height},b}(),a.LineBuilder=function(){function b(b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q;for(null==b&&(b={}),this.graphics=[],g=b.regX||a.config.reel.regX,h=b.regX||a.config.reel.regY,k=b.width||5*a.config.reel.width,j=b.symbolWidth||a.config.symbols.width,i=b.symbolHeight||a.config.symbols.height,f=b.lines||a.config.lines,d=n=0,p=f.length;p>n;d=++n){for(e=f[d],c=new createjs.Graphics,c.setStrokeStyle(5).beginStroke("hsl("+360*d/f.length+", 80%, 50%)"),c.moveTo(0+g,e[0]*i+50+h),l=o=0,q=e.length;q>o;l=++o)m=e[l],l=l*j+50+g,m=m*i+50+h,c.lineTo(l,m);c.lineTo(k,m),this.graphics.push(c)}}return b.prototype.newLine=function(a){return new createjs.Shape(this.graphics[a])},b}(),a.SymbolBuilder=function(){function b(b){var c;c={},_.extend(c,a.config.symbols,b),this.image=c.image||a.loader.getResult("symbols"),this.width=c.width,this.height=c.height,this.numSymbols=Math.floor(this.image.height/this.height),this.numFramesPerSymbol=Math.floor(this.image.width/this.width)}return b.prototype.newSprite=function(a){var b,c,d,e,f,g,h;return null==a&&(a=Math.floor(Math.random()*this.numSymbols)),b=a*this.numFramesPerSymbol,c=(a+1)*this.numFramesPerSymbol-1,d=new createjs.SpriteSheet({images:[this.image],frames:{width:this.width,height:this.height,count:this.numSymbols*this.numFramesPerSymbol},animations:{"static":b,flash:{frames:function(){h=[];for(var a=b;c>=b?c>=a:a>=c;c>=b?a++:a--)h.push(a);return h}.apply(this).concat(function(){g=[];for(var a=f=c-1,d=b+1;d>=f?d>=a:a>=d;d>=f?a++:a--)g.push(a);return g}.apply(this))}}}),e=new createjs.Sprite(d,"static"),e.framerate=30,e.width=this.width,e.height=this.height,e},b}(),$(a.load())}(window.Slots||{})}({},function(){return this}());
//# sourceMappingURL=app.js